# ğŸš€ ä¸€ä¸ªè®©å†…æ ¸â€œè‡ªå¸¦æ–‡ä»¶ç³»ç»Ÿâ€çš„ç¥æŠ€ï¼šæŠŠ init ç¨‹åºç›´æ¥å¡è¿›å†…æ ¸äºŒè¿›åˆ¶ï¼

> åœ¨å†…æ ¸è¿˜ä¸æ”¯æŒè¯»å–ç£ç›˜ã€ä¸æ”¯æŒæ–‡ä»¶ç³»ç»Ÿæ—¶ï¼Œå¦‚æœä½¿ç”¨ä¸€ä¸ªä¸´æ—¶çš„æ–¹å¼æ”¯æŒä¸€ä¸ªç®€å•çš„æ–‡ä»¶ç³»ç»Ÿï¼Ÿ  
> ä»Šå¤©æ•™ä½ ä¸€æ‹›â€”â€”æŠŠæ–‡ä»¶ç³»ç»Ÿç›´æ¥â€˜ç¼–è¯‘è¿›å†…æ ¸â€™ï¼  
> æ— éœ€ç£ç›˜ã€æ— éœ€é©±åŠ¨ï¼Œå†…æ ¸å¯åŠ¨å³æ‰§è¡Œ initï¼Œæè‡´ç®€æ´ï¼â€**

---

## ğŸ’¡ é—®é¢˜ï¼šè‡ªåˆ¶ OS çš„ç¬¬ä¸€é“å â€”â€” â€œå†…æ ¸å¦‚ä½•æ‰¾åˆ° initï¼Ÿâ€

å½“ä½ å†™å®Œç¬¬ä¸€ä¸ªè‡ªåˆ¶æ“ä½œç³»ç»Ÿå†…æ ¸æ—¶ï¼Œä¸€å®šä¼šé‡åˆ°è¿™ä¸ªç»å…¸éš¾é¢˜ï¼š

> **â€œæˆ‘çš„å†…æ ¸å·²ç»è¿è¡Œäº†ï¼Œä½†æ€ä¹ˆåŠ è½½å¹¶æ‰§è¡Œ `init` è¿›ç¨‹å‘¢ï¼Ÿâ€**

ä¼ ç»Ÿæ–¹æ¡ˆï¼š
- âœ… **ä»ç£ç›˜è¯»å–**ï¼šéœ€è¦å®ç°æ–‡ä»¶ç³»ç»Ÿã€å—è®¾å¤‡é©±åŠ¨ã€åˆ†åŒºè¡¨è§£æ...
- âŒ **å¤ªå¤æ‚**ï¼šå¯¹äºåˆå­¦è€…æ¥è¯´ï¼Œè¿™ç®€ç›´æ˜¯â€œåœ°ç‹±çº§â€ä»»åŠ¡ã€‚

æœ‰æ²¡æœ‰æ›´ç®€å•çš„åŠæ³•ï¼Ÿ

**å½“ç„¶æœ‰ï¼**

---

## ğŸ§  æ ¸å¿ƒæ€è·¯ï¼šæŠŠâ€œæ–‡ä»¶ç³»ç»Ÿâ€ç›´æ¥å¡è¿›å†…æ ¸äºŒè¿›åˆ¶ï¼

### ä»€ä¹ˆæ˜¯ initramfsï¼Ÿ
åœ¨ Linux ä¸­ï¼Œ`initramfs`ï¼ˆInitial RAM Filesystemï¼‰æ˜¯ä¸€ä¸ª**å†…å­˜ä¸­çš„æ ¹æ–‡ä»¶ç³»ç»Ÿ**ï¼Œå®ƒè¢«å‹ç¼©ååµŒå…¥åˆ°å†…æ ¸é•œåƒä¸­ã€‚å†…æ ¸å¯åŠ¨æ—¶å°†å…¶è§£å‹åˆ°å†…å­˜ï¼Œç„¶åæŒ‚è½½ä¸ºæ ¹æ–‡ä»¶ç³»ç»Ÿï¼Œå†æ‰§è¡Œ `/sbin/init`ã€‚

æˆ‘ä»¬ä¸æå¤æ‚çš„ initramfsï¼Œè€Œæ˜¯ç”¨ä¸€ä¸ª**æç®€ç‰ˆçš„â€œå†…è”æ–‡ä»¶ç³»ç»Ÿâ€**ï¼š

> **æŠŠ init ç¨‹åºã€é…ç½®æ–‡ä»¶ç­‰ï¼Œç›´æ¥ä»¥äºŒè¿›åˆ¶æ•°æ®çš„å½¢å¼ï¼Œä½œä¸ºâ€œé™æ€æ•°æ®â€ç¼–è¯‘è¿›å†…æ ¸ï¼**

---

## ğŸ› ï¸ å®ç°æ–¹æ³•ï¼šç”¨æ±‡ç¼–æˆ– C è¯­è¨€å°†æ–‡ä»¶å†…å®¹â€œç¡¬ç¼–ç â€è¿›å†…æ ¸

### æŠŠæ–‡ä»¶ç³»ç»Ÿå¡å†…æ ¸äºŒè¿›åˆ¶

#### åˆ›å»ºæ–‡ä»¶ç³»ç»Ÿæ–‡ä»¶ç»“æ„

```
build\rootfs_bin
	|- init
	|- busybox_x86
```


#### å°†å†…å®¹æ‰“åŒ…ä¸ºcpioæ ¼å¼

è„šæœ¬æ–‡ä»¶ï¼š`cpio_fs.sh`

```bash
#!/bin/bash
# æ¥å—ä¸€ä¸ªå‚æ•°ï¼Œå³è¦ç¼–è¯‘çš„ç›®å½•
if [[ $# -eq 0 ]]; then
echo "è¯·æä¾›è¦ç¼–è¯‘çš„ç›®å½•ä½œä¸ºå‚æ•°"
exit 1
fi
# ç¼–è¯‘ç›®å½•
BUILD_DIR="$1"
# è¿›å…¥ç¼–è¯‘ç›®å½•
cd "$BUILD_DIR"
cd rootfs_bin
ls -la ../rootfs.cpio
if [[ -f ../rootfs.cpio ]]; then
rm ../rootfs.cpio
fi
find . -print | cpio -ov --format=newc > ../rootfs.cpio
ls -la ../rootfs.cpio
cd -
```
ç”¨æ³•ï¼š`bash cpio_fs.sh build`

#### å°†cpioæ–‡ä»¶ç¼–è¯‘è¿›å†…æ ¸elfæ–‡ä»¶

```asm
; rootfs.asm - å†…è”æ–‡ä»¶ç³»ç»Ÿ
global __initramfs_start
global __initramfs_end

section .initramfs
__initramfs_start:
    incbin "rootfs.cpio"
__initramfs_end:
```

```
// åœ¨é“¾æ¥è„šæœ¬ä¸­å®šä¹‰ç¬¦å·
// linker.ld
SECTIONS {
    .initramfs : {
        __initramfs_start = .;
        *(.initramfs)
        __initramfs_end = .;
    }
}
```

---

## ğŸ” å†…æ ¸å¦‚ä½•â€œè¯»å–â€è¿™äº›æ•°æ®ï¼Ÿ

### æ­¥éª¤ 1ï¼šè·å–æ•°æ®åœ°å€å’Œå¤§å°

```c
// kernel.c
extern char __initramfs_start[];
extern char __initramfs_end[];

void load_init_from_ramfs(void) {
    size_t fs_size = __initramfs_end - __initramfs_start;
    char *fs_data = __initramfs_start;
    
    // ç°åœ¨ fs_data æŒ‡å‘æ•´ä¸ªâ€œæ–‡ä»¶ç³»ç»Ÿâ€çš„äºŒè¿›åˆ¶æ•°æ®
    // ä½ å¯ä»¥æŒ‰è‡ªå·±çš„æ ¼å¼è§£æå®ƒ
    parse_my_filesystem(fs_data, fs_size);
}
```

### æ­¥éª¤ 2ï¼šè§£æcpioæ–‡ä»¶æ ¼å¼

`cpio`ï¼ˆcopy in / copy outï¼‰æ˜¯ä¸€ç§ç”¨äºå½’æ¡£å’Œä¼ è¾“æ–‡ä»¶çš„ Unix å·¥å…·å’Œæ–‡ä»¶æ ¼å¼ã€‚å®ƒæœ€æ—©å‡ºç°åœ¨ Unix System IIIï¼ˆ1981 å¹´ï¼‰ä¸­ï¼Œæ¯” `tar` æ›´æ—©è¢«æ ‡å‡†åŒ–ï¼ˆPOSIX.1-1988 å°±åŒ…å«äº† `cpio`ï¼‰ï¼Œå°½ç®¡åœ¨æ—¥å¸¸ä½¿ç”¨ä¸­ä¸å¦‚ `tar` æµè¡Œï¼Œä½†å®ƒåœ¨ Linux å†…æ ¸ initramfsã€RPM åŒ…ç®¡ç†å™¨ç­‰å…³é”®ç³»ç»Ÿç»„ä»¶ä¸­è¢«å¹¿æ³›ä½¿ç”¨ã€‚

---

#### ä¸€ã€cpio çš„å·¥ä½œåŸç†

`cpio` æœ¬èº«ä¸ç›´æ¥éå†ç›®å½•ï¼Œè€Œæ˜¯ **ä»æ ‡å‡†è¾“å…¥è¯»å–æ–‡ä»¶è·¯å¾„åˆ—è¡¨**ï¼ˆé€šå¸¸ç”± `find` æˆ– `echo` ç”Ÿæˆï¼‰ï¼Œç„¶åï¼š

- **`-o`ï¼ˆcopy-outï¼‰æ¨¡å¼**ï¼šå°†è¿™äº›æ–‡ä»¶æ‰“åŒ…æˆä¸€ä¸ªå½’æ¡£æµï¼Œè¾“å‡ºåˆ° stdoutã€‚
- **`-i`ï¼ˆcopy-inï¼‰æ¨¡å¼**ï¼šä» stdin è¯»å–å½’æ¡£æµï¼Œè§£åŒ…åˆ°æ–‡ä»¶ç³»ç»Ÿã€‚
- **`-p`ï¼ˆpassï¼‰æ¨¡å¼**ï¼šç›´æ¥å¤åˆ¶æ–‡ä»¶åˆ°æŒ‡å®šç›®å½•ï¼ˆä¸ç”Ÿæˆå½’æ¡£ï¼‰ã€‚

å› æ­¤ï¼Œ`cpio` çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š**å½’æ¡£ = æ–‡ä»¶åˆ—è¡¨ + æ–‡ä»¶å†…å®¹çš„çº¿æ€§æ‹¼æ¥**ã€‚

---

#### äºŒã€cpio çš„å½’æ¡£æ ¼å¼

`cpio` æ”¯æŒå¤šç§æ ¼å¼ï¼Œä¸»è¦åˆ†ä¸ºä¸‰ç±»ï¼š

##### 1. **binaryï¼ˆæ—§æ ¼å¼ï¼Œå·²åºŸå¼ƒï¼‰**
- éå¯ç§»æ¤ï¼Œä¾èµ–å­—èŠ‚åº
- å·²æ·˜æ±°ï¼Œä¸æ¨èä½¿ç”¨

##### 2. **ASCII / "newc" æ ¼å¼ï¼ˆæœ€å¸¸ç”¨ï¼‰**
- **å¯è¯»çš„æ–‡æœ¬å¤´ + äºŒè¿›åˆ¶æ•°æ®**
- è¢« Linux initramfsã€RPM ç­‰å¹¿æ³›é‡‡ç”¨
- æ–‡ä»¶åå’Œå…ƒæ•°æ®ä»¥ **ASCII åå…­è¿›åˆ¶å­—ç¬¦ä¸²**å­˜å‚¨
- **æ”¯æŒé•¿æ–‡ä»¶åï¼ˆæœ€å¤š 256 å­—èŠ‚ï¼Œé»˜è®¤ï¼‰**
- æ‰€æœ‰å­—æ®µå›ºå®šé•¿åº¦ï¼ˆä¾¿äºè§£æï¼‰

###### newc æ ¼å¼çš„å¤´éƒ¨ç»“æ„ï¼ˆæ¯å­—æ®µ 8 å­—èŠ‚ï¼Œå…± 112 å­—èŠ‚ï¼‰ï¼š

| å­—æ®µ | é•¿åº¦ | è¯´æ˜ |
|------|------|------|
| `c_magic` | 6 å­—èŠ‚ | é­”æ•° `"070701"`ï¼ˆnewcï¼‰æˆ– `"070702"`ï¼ˆcrcï¼‰ |
| `c_ino` | 8 å­—èŠ‚ | inode å·ï¼ˆåå…­è¿›åˆ¶ ASCIIï¼‰ |
| `c_mode` | 8 å­—èŠ‚ | æ–‡ä»¶æƒé™ï¼ˆå¦‚ `0100644`ï¼‰ |
| `c_uid` | 8 å­—èŠ‚ | ç”¨æˆ· ID |
| `c_gid` | 8 å­—èŠ‚ | ç»„ ID |
| `c_nlink` | 8 å­—èŠ‚ | ç¡¬é“¾æ¥æ•° |
| `c_mtime` | 8 å­—èŠ‚ | ä¿®æ”¹æ—¶é—´ï¼ˆUnix æ—¶é—´æˆ³ï¼‰ |
| `c_filesize` | 8 å­—èŠ‚ | æ–‡ä»¶å†…å®¹é•¿åº¦ï¼ˆå­—èŠ‚ï¼‰ |
| `c_devmajor` | 8 å­—èŠ‚ | è®¾å¤‡ä¸»è®¾å¤‡å·ï¼ˆä»…è®¾å¤‡æ–‡ä»¶ï¼‰ |
| `c_devminor` | 8 å­—èŠ‚ | è®¾å¤‡æ¬¡è®¾å¤‡å· |
| `c_rdevmajor` | 8 å­—èŠ‚ | ç‰¹æ®Šæ–‡ä»¶çš„ä¸»è®¾å¤‡å· |
| `c_rdevminor` | 8 å­—èŠ‚ | ç‰¹æ®Šæ–‡ä»¶çš„æ¬¡è®¾å¤‡å· |
| `c_namesize` | 8 å­—èŠ‚ | æ–‡ä»¶åé•¿åº¦ï¼ˆåŒ…å«ç»“å°¾ `\0`ï¼‰ |
| `c_checksum` | 8 å­—èŠ‚ | æ ¡éªŒå’Œï¼ˆnewc ä¸­é€šå¸¸ä¸º 0ï¼‰ |

> æ‰€æœ‰æ•°å€¼å­—æ®µå‡ä¸º **8 å­—èŠ‚ ASCII åå…­è¿›åˆ¶å­—ç¬¦ä¸²**ï¼ˆå°ç«¯ï¼Ÿä¸ï¼Œæ˜¯å­—ç¬¦ä¸²ï¼æ¯”å¦‚ 1024 å­˜ä¸º `"00000400"`ï¼‰

###### æ–‡ä»¶è®°å½•å¸ƒå±€ï¼š
```
[112 å­—èŠ‚å¤´éƒ¨] + [N å­—èŠ‚æ–‡ä»¶å + \0] + [å¡«å……è‡³ 4 å­—èŠ‚å¯¹é½] + [æ–‡ä»¶å†…å®¹] + [å¡«å……è‡³ 4 å­—èŠ‚å¯¹é½]
```

- æ–‡ä»¶åå **å¿…é¡»** æœ‰ null å­—ç¬¦ `\0`
- æ–‡ä»¶åå’Œå†…å®¹ä¹‹é—´**è‡ªåŠ¨å¯¹é½åˆ° 4 å­—èŠ‚è¾¹ç•Œ**ï¼ˆç”¨ `\0` å¡«å……ï¼‰
- æ–‡ä»¶å†…å®¹åä¹Ÿ**å¯¹é½åˆ° 4 å­—èŠ‚è¾¹ç•Œ**

###### å½’æ¡£ç»“æŸæ ‡å¿—ï¼š
- ä¸€ä¸ªç‰¹æ®Šæ–‡ä»¶åä¸º `"TRAILER!!!"` çš„æ¡ç›®
- å…¶ `c_filesize = 0`
- è¡¨ç¤ºå½’æ¡£ç»“æŸ

---

##### 3. **crc æ ¼å¼ï¼ˆnewc + æ ¡éªŒå’Œï¼‰**
- ä¸ newc ç±»ä¼¼ï¼Œä½† `c_checksum` å­—æ®µåŒ…å«æ–‡ä»¶å†…å®¹çš„ CRC32 æ ¡éªŒå’Œ
- é­”æ•°ä¸º `"070702"`

---

#### åˆ›å»ºå’Œè§£åŒ… cpio å½’æ¡£

##### åˆ›å»ºå½’æ¡£ï¼ˆnewc æ ¼å¼ï¼‰ï¼š
```bash
# æ–¹æ³•1ï¼šä½¿ç”¨ find
find /path/to/files -print0 | cpio -o -H newc --null > archive.cpio

# æ–¹æ³•2ï¼šæ‰‹åŠ¨æŒ‡å®šæ–‡ä»¶
echo -e "file1.txt\nfile2.txt" | cpio -o -H newc > archive.cpio
```

##### è§£åŒ…å½’æ¡£ï¼š
```bash
cpio -i -d < archive.cpio
# -dï¼šè‡ªåŠ¨åˆ›å»ºæ‰€éœ€ç›®å½•
```

##### åˆ—å‡ºå†…å®¹ï¼š
```bash
cpio -it < archive.cpio
```

### æ­¥éª¤ 3ï¼šè§£æå¹¶æ‰§è¡Œ init

```c
void parse_my_filesystem(char *data, size_t size) {
    struct filesystem_header *header = (struct filesystem_header*)data;
    
    if (header->magic != 0x12345678) {
        panic("Invalid ramfs format!");
    }
    
    for (int i = 0; i < header->entry_count; i++) {
        struct file_entry *entry = &header->entries[i];
        
        if (strcmp(entry->nVjame, "init") == 0) {
            // æ‰¾åˆ° init ç¨‹åº
            char *init_data = data + entry->offset;
            
            // åˆ›å»ºè¿›ç¨‹å¹¶æ‰§è¡Œ
            create_process(init_data, entry->size);
            break;
        }
    }
}
```


å®Œæ•´ä»£ç ï¼š

```c
// rootfs.c
extern char __initramfs_start[];
extern char __initramfs_end[];


int MemFS::load_initramfs(const void* data, size_t size)
{
	const uint8_t* ptr = static_cast<const uint8_t*>(data);
	const uint8_t* end = ptr + size;
	log_info("Loading initramfs, data at %x, size: %d bytes\n", (unsigned int)data, size);
	
	if(size < sizeof(CPIOHeader)) {
		log_err("Invalid initramfs size: %d bytes (minimum required: %d bytes)\n", size,
		sizeof(CPIOHeader));
		return -1;
	}
	
	log_notice("Initramfs size validation passed: %d bytes\n", size);
	while(ptr + sizeof(CPIOHeader) <= end) {
		log_debug("Processing CPIO header at %x\n", (unsigned int)ptr);
		const CPIOHeader* header = reinterpret_cast<const CPIOHeader*>(ptr);
		// debug_info(header->magic);
		if(!magic_match(header->magic)) {
			log_err("Invalid CPIO header magic: %c %c %c\n", header->magic[0], header->magic[1],
			header->magic[2]);
			log_err(
			"magic[3..6]: %c %c %c\n", header->magic[3], header->magic[4], header->magic[5]);
		}

		ptr += sizeof(CPIOHeader);
		if(ptr >= end) {
			log_err("Unexpected end of initramfs");
			break;
		}
		
		// è·å–æ–‡ä»¶å
		uint16_t namesize = get_namesize(header);
		log_info("namesize: %d\n", namesize);
		if(ptr + namesize > end) {
			log_err("Unexpected end of initramfs\n");
			break;
		}
	
		const char* name = reinterpret_cast<const char*>(ptr);
		log_debug("Found file: %s\n", name);
		
		ptr += namesize;
		ptr = (uint8_t*)(((uintptr_t)ptr + 3) / 4 * 4);
		// æ£€æŸ¥æ˜¯å¦ä¸ºç»“æŸæ ‡è®°
		if(is_trailer(name)) {
			log_debug("Trailer found, ending initramfs loading\n");
			break;
		}
	
		// è·å–æ–‡ä»¶æ•°æ®
		uint32_t filesize = get_filesize(header);
		log_debug("filesize: %d\n", filesize);
		
        if (strcmp(name, "init") == 0) {
            
            // åˆ›å»ºè¿›ç¨‹å¹¶æ‰§è¡Œ
            create_process(ptr, filesize);
            break;
        }
		
		if(ptr + filesize > end) {
			log_debug("Unexpected end of initramfs\n");
			break;
		}
	}
}
```


---

## ğŸ¯ ä¼˜åŠ¿ä¸é€‚ç”¨åœºæ™¯

### âœ… ä¼˜åŠ¿
- **æåº¦ç®€åŒ–**ï¼šæ— éœ€ç£ç›˜é©±åŠ¨ã€æ–‡ä»¶ç³»ç»Ÿã€åˆ†åŒºè¡¨
- **å¿«é€Ÿå¯åŠ¨**ï¼šå†…æ ¸ä¸€å¯åŠ¨å°±èƒ½æ‰§è¡Œ initï¼Œæ— éœ€ç­‰å¾…ç£ç›˜ I/O
- **è°ƒè¯•å‹å¥½**ï¼šæ‰€æœ‰ä»£ç éƒ½åœ¨ä¸€ä¸ªäºŒè¿›åˆ¶ä¸­ï¼Œè°ƒè¯•æ–¹ä¾¿
- **å¯ç§»æ¤æ€§å¼º**ï¼šé€‚ç”¨äºä»»ä½•èƒ½è¿è¡Œå†…æ ¸çš„ç¯å¢ƒï¼ˆQEMUã€ç‰©ç†æœºã€åµŒå…¥å¼ï¼‰

### ğŸ¯ é€‚ç”¨åœºæ™¯
- **è‡ªåˆ¶æ“ä½œç³»ç»Ÿå­¦ä¹ **ï¼šåˆå­¦è€…çš„æœ€ä½³èµ·ç‚¹
- **åµŒå…¥å¼ç³»ç»Ÿ**ï¼šèµ„æºå—é™ï¼Œéœ€è¦æœ€å°åŒ–å¯åŠ¨æ—¶é—´
- **å¼•å¯¼åŠ è½½ç¨‹åº**ï¼šåœ¨è¿›å…¥å®Œæ•´æ“ä½œç³»ç»Ÿå‰æä¾›ç®€å•åŠŸèƒ½
- **å®‰å…¨/æ¢å¤ç¯å¢ƒ**ï¼šæ— éœ€ä¾èµ–å¤–éƒ¨å­˜å‚¨

---

## ğŸ“¦ å®é™…åº”ç”¨ï¼šè®©å†…æ ¸â€œè‡ªå¸¦â€ init è¿›ç¨‹

æƒ³è±¡ä¸€ä¸‹ï¼Œä½ çš„å†…æ ¸äºŒè¿›åˆ¶æ–‡ä»¶ `kernel.bin` ä¸ä»…åŒ…å«å†…æ ¸ä»£ç ï¼Œè¿˜åŒ…å«äº†ï¼š

- `/sbin/init`ï¼ˆä½ çš„åˆå§‹åŒ–ç¨‹åºï¼‰
- `/etc/fstab`ï¼ˆæ–‡ä»¶ç³»ç»ŸæŒ‚è½½è¡¨ï¼‰
- `/bin/sh`ï¼ˆShellï¼‰
- `/usr/bin/ls`ï¼ˆå¸¸ç”¨å‘½ä»¤ï¼‰

è¿™ä¸€åˆ‡éƒ½**ç¼–è¯‘è¿›åŒä¸€ä¸ªæ–‡ä»¶**ï¼

å¯åŠ¨æµç¨‹å˜æˆï¼š

```
1. CPU ä¸Šç”µ â†’ BIOS å¯åŠ¨ â†’ åŠ è½½ kernel.bin
2. å†…æ ¸åˆå§‹åŒ– â†’ è§£æå†…è”æ–‡ä»¶ç³»ç»Ÿ â†’ æ‰¾åˆ° /sbin/init
3. æ‰§è¡Œ /sbin/init â†’ ç”¨æˆ·ç©ºé—´å¯åŠ¨
```

**æ²¡æœ‰ç£ç›˜ã€æ²¡æœ‰é©±åŠ¨ã€æ²¡æœ‰æ–‡ä»¶ç³»ç»Ÿâ€”â€”åªæœ‰çº¯ç²¹çš„å†…æ ¸å’Œå®ƒçš„â€œå†…ç½®æ–‡ä»¶â€ï¼**

---

## ğŸ’¡ é«˜é˜¶æŠ€å·§ï¼šåŠ¨æ€ç”Ÿæˆæ–‡ä»¶ç³»ç»Ÿ

å¦‚æœä½ çš„ init ç¨‹åºæ˜¯ç”¨ C/C++ ç¼–å†™çš„ï¼Œå¯ä»¥å†™ä¸€ä¸ª**æ„å»ºè„šæœ¬**ï¼Œè‡ªåŠ¨å°†æºæ–‡ä»¶ç¼–è¯‘æˆäºŒè¿›åˆ¶ï¼Œå†åµŒå…¥åˆ°å†…æ ¸ä¸­ï¼š

```bash
#!/bin/bash
# build.sh

# ç¼–è¯‘ init ç¨‹åº
gcc -o init init.c

# å°† init ç¨‹åºè½¬ä¸º C æ•°ç»„
xxd -i init > init_data.c

# ç¼–è¯‘å†…æ ¸
make

# æœ€ç»ˆçš„å†…æ ¸äºŒè¿›åˆ¶å°±åŒ…å«äº† init ç¨‹åºï¼
```

---

## ğŸš« æ³¨æ„äº‹é¡¹

- **å†…å­˜å ç”¨**ï¼šæ‰€æœ‰æ–‡ä»¶éƒ½åŠ è½½åˆ°å†…å­˜ï¼Œä¸é€‚åˆå¤§æ–‡ä»¶
- **æ›´æ–°å›°éš¾**ï¼šä¿®æ”¹æ–‡ä»¶éœ€é‡æ–°ç¼–è¯‘å†…æ ¸
- **å®‰å…¨æ€§**ï¼šæ‰€æœ‰ä»£ç éƒ½åœ¨å†…æ ¸ä¸­ï¼Œä¸€æ—¦å‡ºé”™å¯èƒ½å¯¼è‡´ç³»ç»Ÿå´©æºƒ

---

## âœ… æ€»ç»“ï¼šä¸€ä¸ªç®€å•å´å¼ºå¤§çš„æŠ€å·§

è¿™ä¸ªå°æŠ€å·§çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š

> **â€œä¸è¦å»è¯»å–ç£ç›˜ä¸Šçš„æ–‡ä»¶ï¼Œè€Œæ˜¯æŠŠæ–‡ä»¶ç›´æ¥â€˜å˜æˆâ€™å†…æ ¸çš„ä¸€éƒ¨åˆ†ã€‚â€**

å®ƒå®Œç¾è§£å†³äº†è‡ªåˆ¶ OS åˆæœŸçš„â€œé¸¡ç”Ÿè›‹ã€è›‹ç”Ÿé¸¡â€é—®é¢˜ï¼š

- **æ²¡æœ‰æ–‡ä»¶ç³»ç»Ÿ â†’ æ— æ³•è¯»å– init**
- **æ²¡æœ‰ init â†’ æ— æ³•æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿ**

é€šè¿‡è¿™ä¸ªæŠ€å·§ï¼Œæˆ‘ä»¬ç»•è¿‡äº†è¿™ä¸ªæ­»å¾ªç¯ï¼Œè®©å†…æ ¸**è‡ªç»™è‡ªè¶³**ã€‚

---

**å…³æ³¨æˆ‘ï¼Œå¸¦ä½ ä»é›¶å¼€å§‹ï¼Œç©è½¬æ“ä½œç³»ç»Ÿå¼€å‘ï¼**